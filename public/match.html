<!DOCTYPE html>
<html>
<head>
  <title>Your Match ‚Ä¢ Cupid's Code</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia">

<link rel="icon" href="cc1.jpeg" type="image/jpeg">
<link rel="apple-touch-icon" href="cc2.jpeg">
<link rel="manifest" href="/manifest.json">

</head>

<body class="quiz-page">

  <!-- HEADER -->
  <h1 class="title-box">
    <div class="top-line">
      <span class="block-text">CUPID'S</span>
      <span class="cursive-text">code</span>
      <span class="sub-text2"> : your perfect match awaits üíò</span>
    </div>
  </h1>

  <!-- LOGOUT BUTTON (always visible if logged in) -->
  <button id="logoutBtn" style="
    position:absolute;
    top:20px;
    right:20px;
    padding:10px 18px;
    background:#de5577;
    color:white;
    border:none;
    border-radius:8px;
    font-weight:bold;
    cursor:pointer;
  ">
    Log Out
  </button>

  <!-- BEST MATCH SECTION -->
  <div id="best-match" style="text-align:center; margin-top:20px;">
    <h2 style="color:#faaabe;">Finding your best match...</h2>
  </div>

  <!-- ALL MATCHES TITLE -->
  <div id="matchresults" style="text-align:center; margin-top:40px;">
    <h2 style="color:#faaabe;">All Matches</h2>
    <p>Explore your compatibility with everyone ‚ú®</p>
  </div>

  <!-- GRID CONTAINER -->
  <div id="match-grid"></div>

  <!-- LOGIN CHECK + BEST MATCH FETCH -->
  <script>
    const username = localStorage.getItem("username");

    if (!username) {
      document.getElementById("logoutBtn").style.display = "none";

      document.getElementById("best-match").innerHTML = `
        <h2>You must log in first.</h2>
        <a href="homepage.html" style="
          display:inline-block;
          padding:10px 20px;
          background:#faaabe;
          color:white;
          border-radius:6px;
          text-decoration:none;
          font-weight:bold;
          margin-top:10px;
        ">Go to Home</a>
      `;
    } else {
      // Fetch BEST match
      fetch(`/match?username=${username}`)
        .then(res => res.json())
        .then(data => {
          const box = document.getElementById("best-match");

          if (!data.match) {
            box.innerHTML = `
              <h2>Your spark has yet to be lit..</h2>
              <p>Tell your friends to take the quiz so we can find a match ‚ù§Ô∏è‚Äçüî•</p>
            `;
            return;
          }

          const m = data.match;

          box.innerHTML = `
            <h2 style="color:#faaabe">‚ú® Your Best Match ‚ú®</h2>
            <h1 style="font-size:2.2rem; color:#de5577;">${m.name}</h1>

            <p style="font-weight:bold; color:#faaabe;">
              Compatibility Score:
              <span style="color:#faaabe; font-size:1.4rem;">
                ${data.score}%
              </span>
            </p>

            <p><strong>Age:</strong> ${m.age}</p>
            <p><strong>Personality:</strong> ${m.personality}</p>
            <p><strong>Zodiac:</strong> ${m.zodiac}</p>

            <hr style="margin:20px auto; width:60%; border:1px solid #de899e;">
          `;
        });
    }
  </script>

  <!-- LOGOUT HANDLER -->
  <script>
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "homepage.html";
    });
  </script>

  <!-- MATCH GRID SCRIPT -->
  <script src="matches.js"></script>

</body>
</html>
